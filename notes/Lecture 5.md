### 卷积

1.  **(a) Origin f 和 (b) Padded f**:
	原始图像 `f` (其有效内容为 3x3) 的周围被加上了一圈

3.  **(c) Rotated w**:
	在数学的严格定义中，进行卷积运算前，需要将卷积核 `w` 旋转180度，公式 $(f*w)(x,y) = \sum f(x-a, y-b)w(a,b)$ 就隐含了这个旋转操作，这与很多深度学习库中实现的、不旋转卷积核的“互相关 (Cross-correlation)”运算略有不同

4.  **(d) Convolution result**: 与原始图像 `f` 的有效内容尺寸相同
    * 输入尺寸 $N=3$，卷积核尺寸 $F=3$ (即 $K=1$)
    * 通过进行一圈补零 ($P=K=1$)，最终输出尺寸与输入尺寸保持一致

5.  **(e) Full convolution result**: 这个结果的尺寸是 5x5
    * 输入尺寸 $N=3$，卷积核尺寸 $F=3$ (即 $K=1$)
    * 根据 ‘Full’ 卷积的尺寸公式 $N_{out} = N + F - 1 = N + 2K$
    * 我们得到输出尺寸是 $3 + 3 - 1 = 5$ (或者 $3 + 2(1) = 5$)

* **Same 卷积** 如何通过填充保持尺寸不变
* **Full 卷积** 如何通过更多的填充使输出尺寸变大，并且其尺寸放大规律遵循了我们讨论过的 $N+2K$ （或 $N+F-1$）的公式
* 交换律 结合律 分配律

### 平滑处理 ( Smoothing (noise reduction) )

* 线性：权重滤波 ( Averaging filter )
* 非线性：中值滤波 ( Order statistics filter )


### 边界 ( Edge)

* 图像梯度 Gradient
* 梯度幅值 Magnitude
* 图像边界法线量 direction： Edge 外法线方向 ( 数学分析 )
* [Canny Edge](https://zhuanlan.zhihu.com/p/447565904) ( 高斯平滑 + 幅值 + 方向 + 非最大化抑制 + 双阈值 + 强边缘 + 连接弱边缘 )


### 锐化 ( Sharpening )

##### Laplacian filter

拉普拉斯算子是一种二阶微分算子，其在二维图像函数 $f(x,y)$ 上的连续定义为：
$$\nabla^2 f = \frac{\partial^2 f}{\partial x^2} + \frac{\partial^2 f}{\partial y^2}$$
$$\frac{\partial^2 f}{\partial x^2} \approx [f(x+1, y) - f(x, y)] - [f(x, y) - f(x-1, y)] = f(x+1, y) + f(x-1, y) - 2f(x, y)$$
$$\frac{\partial^2 f}{\partial y^2} \approx [f(x, y+1) - f(x, y)] - [f(x, y) - f(x, y-1)] = f(x, y+1) + f(x, y-1) - 2f(x, y)$$
将这两个方向的二阶导数近似相加，就得到了离散拉普拉斯算子的表达式：
$$\nabla^2 f \approx [f(x+1, y) + f(x-1, y) + f(x, y+1) + f(x, y-1)] - 4f(x, y)$$
最常用的形式是考虑4邻域的滤波器：
$$
K_4 = \begin{bmatrix}
0 & 1 & 0 \\
1 & -4 & 1 \\
0 & 1 & 0
\end{bmatrix}
$$
$$
K_8 = \begin{bmatrix}
1 & 1 & 1 \\
1 & -8 & 1 \\
1 & 1 & 1
\end{bmatrix}
$$
##### 锐化机理：$f - c · \nabla^2 f$

锐化的通用公式为：
$$g(x, y) = f(x, y) - c \cdot [\nabla^2 f(x, y)]$$
其中 $g$ 是锐化后的图像


 $\nabla^2 f$ 的响应特性：对于一个从亮到暗的边缘，当使用中心为负的核（如-4或-8）时，$\nabla^2 f$ 在边缘的亮区一侧会产生负响应，在暗区一侧会产生正响应；在平坦区域，响应为0。

##### 反锐化掩模 (Unsharp Masking) 

图像的细节信息（如边缘、纹理）存在于高频区域。通过将原图减去其自身的模糊版本（低通滤波结果），可以直接提取出这些高频的细节信息，形成一个“掩模”。将这个只包含细节的掩模叠加回原图，即可达到强化细节、锐化图像的目的

$$g_{\text{mask}}(x, y) = f(x, y) - \bar{f}(x, y)$$
$$g(x, y) = f(x, y) + g_{\text{mask}}(x, y)$$

##### Highboost Filtering (高提升滤波)

$$g(x, y) = f(x, y) + k \cdot g_{\text{mask}}(x, y)$$


### 图像滤波的实现细节

##### 边界填充策略

当滤波器核的中心位于图像边界时，核的一部分会悬挂在图像外部

- 常量填充 (Constant Padding)
    在图像边界外填充一个固定的常数值，最常见的是填充0。这种方法实现简单，但可能在图像边界产生不自然的人为边缘，干扰后续计算
    
- 复制填充 (Replicate Padding)
    将图像最外围的一行或一列像素的值复制并延伸出去。这种方法能较好地保持边界的纹理，产生的人为边缘较弱，是一个高效的默认选项
    
- 镜像填充 (Reflect Padding)
    以图像的边界为轴，将边界内的像素值镜像反射到外部。这通常是效果最好的方式，能创造最自然的过渡，最大限度地减少人为边缘效应
    
- 平铺填充 (Wrap Padding)
    将图像看作可无限平铺的纹理，用图像相对一侧的内容来填充边界。这种方法适用于内容具有周期性的特殊场景

##### 拉普拉斯滤波结果的处理

拉普拉斯滤波的输出 $\nabla^2 f$ 是一个包含正负值的数学矩阵，其处理方式取决于后续目的。

- **用于锐化计算**: 直接使用原始的、未经任何处理的计算结果。锐化公式 $f - c \cdot \nabla^2 f$ 需要真实的数学值来进行正确的代数运算。对这个中间结果进行截断或归一化会破坏边缘信息。
- **用于可视化**: 必须进行归一化处理。为观察“边缘图”，需要将其数值范围线性映射到可显示的灰度范围，如 $[0, 255]$。通常找到结果中的最大值 $max$ 和最小值 $min$，再应用公式 $v' = 255 \cdot (v - min) / (max - min)$。在此场景下截断是错误的，因为它会丢弃所有负值信息，导致边缘特征丢失。
    
##### 最终锐化结果的处理

经过锐化公式 $f - c \cdot \nabla^2 f$ 计算后，最终的像素值可能超出有效显示范围，如小于0或大于255

- **解决方案**: 进行截断 (Truncation / Clipping)
- **原因**: 锐化的目的是增强局部对比度，而非改变全局色调。截断只处理因锐化过度而“溢出”的像素，保留了图像原始的亮度分布。而归一化会拉伸整个图像的灰度范围，可能导致未锐化区域的对比度发生非预期的改变。因此，在处理最终结果时，截断是标准方法。

### 空间域滤波和频率域滤波

### 可分离滤波器 与 高斯核的复合


