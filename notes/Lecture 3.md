### N-dimension Histogram

* 坐标 $(i, j)$ 指的是同一位置第一张图灰度值为 $i$ ，第二张图灰度值为 $j$ 的位置个数 

### Histogram Equalization

1. 计算原始直方图
2. 计算累积分布函数
3. 使用累计分布函数进行变换，向均匀分布前进
4. $S = T(R) = round((L−1) \times CDF(R))$

### 思考题

* 对同一图像多次使用直方图均衡化的结果是什么？

其效果会快速收敛，第一次均衡化会产生绝大部分的视觉变化；第二次及后续的均衡化所带来的改变会非常微小，并迅速减弱。在几次迭代之后，图像会达到一个不再变化的稳定状态。

* 如果一个图像有太多背景色，均衡化的结果是什么？

直方图均衡化的结果通常不理想，可能导致图像中重要前景区域的对比度下降。原因在于直方图的分布，大面积的背景色会在直方图中的某个特定灰度级上形成一个非常高的尖峰，直方图均衡化算法在计算累积分布函数 (CDF) 时，会平等对待每一个像素，这个巨大的尖峰会导致CDF在该灰度级处产生一个急剧的、大幅度的跃升。 在变换过程中，这个包含大量像素的背景灰度范围会被映射到输出图像的一个很宽的灰度范围内。相应地，代表图像中其他（通常是更重要的前景）细节的、像素数量较少的灰度级，则会被压缩到一个非常窄的灰度范围内

### Local Histogram Processing - Entropy of Images

* 基于局部统计量的增强 (via local histogram statistics)

* 基于信息论度量的增强 (via information theoretic measurements)
* 图像熵 (Entropy of an image) v.s. 熵图像 (Entropy Image, EI)


### 把图像二值化的阈值变换 - Thresholding

* 数字图像处理: 10.3 阈值处理

##### 迭代法全局阈值处理 (Basic Global Thresholding)

* A simple iterative threshold method
* Implement it based on histogram
* Clustering problem: a principle method

利用 $n \times k$ 个示性函数表示点在哪个聚类中，然后构建目标函数最小化各个点到其中心点距离平方和，使用迭代方法求解 $k-means$: 确定类中心点 $\rightarrow$ 调整组内点 $\rightarrow$ 调整类中心点

##### Otsu算法 (最大类间方差法)

Otsu算法是一种经典的自动图像阈值处理方法。其核心思想是遍历所有可能的灰度阈值，寻找到一个最佳阈值，该阈值能够使得分割出的前景和背景两个类别的**类间方差 (between-class variance)** 最大化。当类间方差最大时，意味着前景与背景的差异最显著，从而达到最佳分割效果。

算法的步骤如下：
* **1. 计算灰度直方图**: 统计图像中每个灰度级 $i$ 出现的像素数量 $n_i$。
* **2. 计算概率分布**: 计算每个灰度级出现的概率 $P(i) = \frac{n_i}{N}$，其中 $N$ 是图像的总像素数。
* **3. 遍历所有阈值**: 设阈值 $t$ 从 0 遍历到 $L-1$（L为总灰度级数）。对于每一个 $t$ 值：
    * 将像素分为背景类（灰度级 $0$ 到 $t$）和前景类（灰度级 $t+1$ 到 $L-1$）。
    * 计算背景类的权重 $\omega_{bk} = \sum_{i=0}^{t} P(i)$ 和前景类的权重 $\omega_{fg} = 1 - \omega_{bk}$。
    * 计算背景类的均值 $\mu_{bk} = \frac{\sum_{i=0}^{t} i P(i)}{\omega_{bk}}$ 和前景类的均值 $\mu_{fg} = \frac{\sum_{i=t+1}^{L-1} i P(i)}{\omega_{fg}}$。
    * 计算类间方差 $\sigma_{bet}^{2}(t) = \omega_{bk}(\mu_{bk} - \mu_{glb})^{2} + \omega_{fg}(\mu_{fg} - \mu_{glb})^{2}$，其中 $\mu_{glb}$ 是整幅图像的全局均值。
* **4. 确定最佳阈值**: 使得类间方差 $\sigma_{bet}^{2}(t)$ 最大的那个 $t$ 值，即为最终确定的最佳阈值。

##### 高斯核

我们从二维高斯函数开始，这是生成高斯核的理论基础：
$$G(x, y) = \frac{1}{2\pi\sigma^2} e^{-\frac{x^2 + y^2}{2\sigma^2}}$$
这个公式描述了一个以原点(0,0)为中心，标准差为$\sigma$的二维"钟形"曲面。要创建一个离散的卷积核，我们实际上是在这个连续的曲面上进行采样。

实例：构建一个3x3的高斯核 (假设 $\sigma=1$)

$$
\begin{pmatrix}
(-1, 1) & (0, 1) & (1, 1) \\
(-1, 0) & (0, 0) & (1, 0) \\
(-1, -1) & (0, -1) & (1, -1)
\end{pmatrix}
$$
$$
K_{unnormalized} =
\begin{pmatrix}
0.05855 & 0.09654 & 0.05855 \\
0.09654 & 0.15915 & 0.09654 \\
0.05855 & 0.09654 & 0.05855
\end{pmatrix}
$$
在实际计算中，为了提高效率，常常使用整数核来近似。例如，上面这个核可以通过乘以某个系数再四舍五入得到一个整数核，最常见的3x3高斯核近似为：
$$
K_{integer} = \frac{1}{16}
\begin{pmatrix}
1 & 2 & 1 \\
2 & 4 & 2 \\
1 & 2 & 1
\end{pmatrix}
$$

##### Local adaptive thresholding (局部自适应阈值处理)

* 基于局部图像性质的可变阈值处理：均值和标准差

* 基于移动平均的可变阈值处理：移动 Z 字平均值

* Local variable threshold based on Local entropy (局部熵)
